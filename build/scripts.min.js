function getData(e){for(var a=[],t=0;t<e.length;t++){var n={};for(var s in e[t])e[t].hasOwnProperty(s)&&(n[s]=e[t][s],console.log(s+" -> "+e[t][s]));a.push(n)}return a}function queryParams(){return{limit:limit,offset:0}}var limit=10,offset=0,tableID="#usersTable",loadTable=function(e){var a={offset:offset+=10,limit:limit};$.ajax({url:MainURL,data:a,success:function(e){$(tableID).bootstrapTable({data:getDataUser(e.data)}),$(tableID).scrollTop($("#button").position().top)}})};$(function(){$("#button").click(function(){var e={offset:offset+=10,limit:limit};$.ajax({url:"https://livedemo.xsolla.com/fe/test-task/baev/users",data:e,success:function(e){$(tableID).bootstrapTable("append",getDataUser(e.data)),$(tableID).scrollTop($("#button").position().top)}})});var e=$(tableID).bootstrapTable("getOptions");e.height="100%",$(tableID).bootstrapTable("refreshOptions",e)});var resizeTable=function(){$(tableID).bootstrapTable("resetView");$(window).width();var e=$(window).height()-230;$("#usersContent").height(e)};$(window).on("load resize",function(e){resizeTable()});var LinkFormatter=function(e,a,t){return"<a href='/users/"+e+"'>"+e+"</a>"},getDataUser=function(e){for(var a=[],t=0;t<e.length;t++){var n={};n.register_date=getDate(e[t].register_date),n.enabled=getStatus(e[t].enabled),n.user_name=e[t].user_name,n.user_id=e[t].user_id,n.user_custom=e[t].user_custom,n.email=e[t].email,n.balance=n.balance,n.wallet_amount=getSum(e[t].wallet_amount,e[t].wallet_currency),a[t]=n}return a},resize=function(){},showUser=function(){$.ajax({url:"https://livedemo.xsolla.com/fe/test-task/baev/users/1",success:function(e){alert(e)}})},MainURL="https://livedemo.xsolla.com/fe/test-task/baev/users",Enable,getUser=function(e){$.ajax({url:MainURL+"/"+e,success:function(e){for(var a={enabled:getStatus(e.enabled),user_id:e.user_id,register_date:getDate(e.register_date),wallet_amount:getWallet(e.wallet_amount,e.wallet_currency),balance:e.balance,user_name:e.user_name,user_custom:e.user_custom,email:e.email},t=$(".form-horizontal").find("[name]"),n=0;n<t.length;n++){var s=$(t[n]);if(s.is("p")){r=s.attr("name");s.text(a[r])}else if(s.is("input")){var r=s.attr("name");s.val(a[r])}}Enable=e.enabled,$("[name='email']").bind("input",function(){isEmail($(this))}),$("[name='amount']").bind("input",function(){isDigit($(this))}),$("[name='comment']").bind("input",function(){isEmpty($(this))})}})},getStatus=function(e){return e?"Активен":"Неактивен"},getDate=function(e){return new Date(e).format("dd.mm.yyyy HH:MM")},getWallet=function(e,a){var t="0";return e&&(t=e),a&&(t+=" "+a),t},isDigit=function(e){""==e.val()?(e.siblings(".help-block").show(),e.parent().removeClass("has-success"),e.parent().addClass("has-error")):(e.siblings(".help-block").hide(),e.parent().addClass("has-success"),e.parent().removeClass("has-error")),/^[0-9]+\.*[0-9]*$/.test(e.val())||(e.val(""),e.siblings(".help-block").show(),e.parent().removeClass("has-success"),e.parent().addClass("has-error"))},isEmpty=function(e){""==e.val()?(e.siblings(".help-block").show(),e.parent().removeClass("has-success"),e.parent().addClass("has-error")):(e.siblings(".help-block").hide(),e.parent().addClass("has-success"),e.parent().removeClass("has-error"))},isEmail=function(e){if(""==e.val())return 0;var a=/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;return a.test(e.val())?(e.siblings(".help-block").text("Email введен корректно"),e.parent().addClass("has-success"),e.parent().removeClass("has-error")):(e.siblings(".help-block").show(),e.siblings(".help-block").text("Email введен некорректно"),e.parent().removeClass("has-success"),e.parent().addClass("has-error")),a.test(e.val())},editUser=function(e){if(!isEmail($("[name='email']")))return 0;var a=$("#userForm").serializeArray(),t={};t.enabled=Enable;for(var n=0;n<a.length;n++){var s=a[n].name,r=a[n].value;t[s]=r}t=JSON.stringify(t),$.ajax({url:MainURL+"/"+e,type:"PUT",data:t,complete:function(){alert("complete")},statusCode:{200:function(){$("[name='email']").siblings(".help-block").hide(),$("[name='email']").parent().removeClass("has-success")},403:function(e){}}})},editBalance=function(e){for(var a=$("#balanceForm").serializeArray(),t={},n=0;n<a.length;n++){var s=a[n].name,r=a[n].value;t[s]=r}t=JSON.stringify(t);var i=MainURL+"/"+e+"/recharge";$.ajax({url:i,type:"POST",data:t,success:function(e){var a=$(".form-horizontal").find("[name='balance']");a&&e.amount&&a.text(e.amount),$("#balanceForm [name]").val("")}})},isComment=function(){return""!=$("#balanceForm [name='comment']").val()},createUser=function(){for(var e=$("#newUserForm").serializeArray(),a={},t=0;t<e.length;t++){var n=e[t].name,s=e[t].value;a[n]=s}a=JSON.stringify(a),$.ajax({url:MainURL,type:"POST",data:a,statusCode:{200:function(){$("[name='email']").siblings(".help-block").hide(),$("[name='email']").parent().removeClass("has-success")},403:function(e){},204:function(){alert("ggg")}},success:function(e){alert(e)}})},findTransaction=function(e,a,t,n){var s={};s.datetime_from=t.format("yyyy-mm-dd'T'HH:MM:ss'Z'"),s.datetime_to=n.format("yyyy-mm-dd'T'HH:MM:ss'Z'");var r=MainURL+"/"+a+"/transactions";$.ajax({url:r,type:"GET",data:s,success:function(a){e.bootstrapTable("append",getDataTransaction(a))}})},getDataTransaction=function(e){for(var a=[],t=0;t<e.length;t++){var n={};n.date=getDate(e[t].date),n.status=getStatusTransaction(e[t].status),n.operation_id=e[t].operation_id,n.user_id=e[t].user_id,n.transaction_type=getTypeTransaction(e[t].transaction_type,e[t].coupon_code,e[t].transaction_id),n.amount=getBalance(e[t].amount,e[t].user_balance),n.sum=getSum(e[t].sum,e[t].currency),n.comment=e[t].comment,a[t]=n}return a},getBalance=function(e,a){return e+" ("+a+")"},getStatusTransaction=function(e){var a;switch(e){case"notified":a="Заявка";break;case"completed":a="Завершена";break;default:a=""}return a},getTypeTransaction=function(e,a,t){a||(a=""),t||(t="");var n;switch(e){case"coupon":n="Купоны "+a;break;case"payment":n="Заявка "+t;break;case"inGamePurchase":n="Покупка в игре";break;case"internal":n="Внутренняя";break;case"cancellation":n="Отклонено";break;default:n=""}return n},getSum=function(e,a){var t="0";return e&&(t=e),a&&(t+=" "+a),t};